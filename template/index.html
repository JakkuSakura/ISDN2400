<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ISDN 2400 deCOVID car control panel</title>
  <meta name="description" content="ISDN 2400 deCOVID car control panel">
  <meta name="author" content="Team 10">

  <meta property="og:title" content="ISDN 2400 deCOVID car control panel">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://github.com/qiujiangkun/ISDN2400">
  <meta property="og:description" content="ISDN 2400 deCOVID car control panel">
  <meta property="og:image" content="image.png">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <link rel="stylesheet" href="css/styles.css?v=1.0">
  <script
    src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
    crossorigin="anonymous"></script>

  <script type="text/javascript" src="/static/joystick.js"></script>

</head>

<body>
<h1>deCOVID Car Controller</h1>
<div id="status">
</div>
<img src="/screenshot" alt="Screenshot" id="screenshot"/>

<script>
    function on_joystick_change_left(jsk) {
        console.log(`chassis dx ${jsk.dx} dy ${jsk.dy} udx ${jsk.udx} udy ${jsk.udy}`);
        $.post(
            '/move', {
                udx: jsk.udx,
                udy: -jsk.udy
            }
        )
    }
    function on_joystick_change_right(jsk) {
        console.log(`arm dx ${jsk.dx} dy ${jsk.dy} udx ${jsk.udx} udy ${jsk.udy}`);
        $.post(
            '/rotate', {
                speed: jsk.udx
            }
        )
        $.post(
            '/arm', {
                speed: -jsk.udy
            }
        )
    }

    var joystick_left = new JoyStick({
        radius: 80,
        x: window.innerWidth / 2 - 180,
        y: window.innerHeight / 2,
        inner_radius: 70,
        callback: on_joystick_change_left
    });
    var joystick_right = new JoyStick({
        radius: 80,
        x: window.innerWidth / 2 + 180,
        y: window.innerHeight / 2,
        inner_radius: 70,
        callback: on_joystick_change_right
    });
    function refresh_screenshot() {
        $("#screenshot").attr("src", "/screenshot?t=" + new Date().getTime());
    }
    $(document).ready(function () {
        setInterval(refresh_screenshot, 200);
    });
</script>
</body>
</html>